---
title: "Pesca - Desembarques de capturas marítimas"
author: "Leonel Fernando Cejas"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(readr)
library(ggplot2)
library(lubridate)


```





**Introducción**


El trabajo se realiza a partir de bases de datos de el sitio web 
https://www.datos.gob.ar/ . Estos datos fueron provistos por la Subsecretaría
de Pesca y Acuicultura de la República Argentina. Comprenden las capturas 
realizadas por buques que operan dentro de la ZEE de la República Argentina en 
el período de 2010 a 2018



## Exploración de los datos

** En primer lugar hacemos una exploración de datos y seguidamente asignamos 
a una variable la bbdd completa con la que elejí trabajar**



```{r}
captura_puerto_flota_2010_2018 <- read_csv("datos/captura-puerto-flota-2010-2018.csv", 
                                           locale = locale(encoding = "windows-1252"))
```

##Como la columna "fecha" se encuentra en caracteres se procede a convertirla
## a formato fecha


```{r}
captura_puerto_flota_2010_2018 <-
  captura_puerto_flota_2010_2018 |> 
  mutate(fecha = ym (fecha))
  
```




##Contiene 41341 observaciones y 13 variables que son las que se mencionan a continuación: 

"fecha"            "flota"            "puerto"           "provincia"        "provincia_id"    
"departamento"     "departamento_id"  "latitud"          "longitud"         "categoria"       
"especie"          "especie_agrupada" "captura"         



```{r}
colnames(captura_puerto_flota_2010_2018)
```



**lista de especies**

Se observan 89 especies marítimas

```{r}

lista_de_especies <-
  unique(captura_puerto_flota_2010_2018$especie)

```



**lista de puertos**



Se observan 23 puertos

```{r}

lista_de_puertos <-
  unique(captura_puerto_flota_2010_2018$puerto)
```

**Exploración de los datos**

Seleccioná algunas variables resulten interesantes y mostrá sus propiedades.
Algunas cosas para mostrar:

-   ¿Cuál es su valor medio y desvío estándard?
-   ¿Cuál es su rango (valor máximo y valor mínimo)?
-   ¿Hay alguna anomalía que sugiera que hay datos incorrectos? Valores imposibles (como valores negativos en una variable que sólo puede ser positiva) o poco creíbles.
-   ¿Cuántas observaciones hay por cada grupo? ¿Cuántos valores faltantes? ¿Hay diferencias?


```{r}
todos_esp_tot<-

captura_puerto_flota_2010_2018 |>
  group_by(puerto) |>
  mutate(total_puerto = sum(captura, na.rm = TRUE)) |> 
  select(puerto, captura, especie, total_puerto) |> 
  
  group_by(especie) |>
  summarise(total_especie = sum(captura))
  
```



```{r}
todos_esp_tot<-
  todos_esp_tot |> 
  mutate(captura_total= sum(total_especie, na.rm = TRUE)) |> 
  mutate(especie_sobre_total = total_especie/captura_total) |> 
  arrange(-especie_sobre_total)

```













```{r}
filter(captura_puerto_flota_2010_2018, provincia_id == "06")

```
estos datos se pierden

```{r}
filter(captura_puerto_flota_2010_2018, puerto == "Mar del Plata")

```

```{r}
captura_puerto_flota_serie_tiempo <- read_csv("datos/captura-puerto-flota-serie-tiempo.csv")
```

```{r}
read.csv ("datos/captura-puerto-flota-serie-tiempo.csv")
```





```{r}
captura_puerto_flota_2010_2018 |> 
  filter ( fecha %in% c("2010-04", "2010-05", "2010-06")) |> 
  group_by(puerto) 
  

```
## otra forma de seleccionar un rango sin escribir todo

```{r}
captura_puerto_flota_2010_2018 |>
  filter(fecha >= "2010-04") |>
  filter(fecha <= "2010-06")
  
```











```{r}
 captura_puerto_flota_2010_2018 |>
  filter(fecha=="2010-01") |>
  mutate(proporcion = captura [especie = "Merluza hubbsi"]/captura)
  

```

##captura media es la suma de la captura por especie dividido el nro de casos, que son 26



```{r}
captura_puerto_flota_2010_2018 |> 
   filter(fecha=="2010-01") |>
  group_by(especie) |> 
  summarise(captura_media=mean(captura, na.rm =TRUE))
```

quiero saber cuantos casos aparece merluza hubbsi en lo anterior

```{r}

library(tidyverse)
aparece_especie <- captura_puerto_flota_2010_2018 %>%
  
  filter(fecha=="2010-01") |>
  group_by(especie) |>
  tally()
  
```

```{r}
unique(captura_puerto_flota_2010_2018$especie)
```
##tiene 13 columnas!

```{r}

glimpse(captura_puerto_flota_2010_2018)
```

suma de la captura filtrando fecha


```{r}
captura_2010_01_todas <- captura_puerto_flota_2010_2018 |> 
  filter(fecha=="2010-01") |>
  summarise(captura = sum(captura))

```


## ahora sumo la captura de la merluza en ese periodo


```{r}
captura_2010_01_Merluzahubbsi <- captura_puerto_flota_2010_2018 |> 
  filter(fecha == "2010-01") |> 
  filter(especie == "Merluza hubbsi") |> 
  summarise(captura = sum(captura))

```

ahora le asigno una variable a cada cosa y saco la media

```{r}
captura_2010_01_Merluzahubbsi/captura_2010_01_todas

```
## averiguar como fueron las capturas por especies por año y hacer un cuadro a traves del tiempo




```{r}
captura_puerto_flota_2010_2018 |> 
  filter (especie %in% c("Merluza hubbsi", "Rayas nep", "Langostino", "Calamar Illex"))
```


## hago variable de  especies representativas (especies_repre)

```{r}

especies_repre <-
  captura_puerto_flota_2010_2018 |> 
  filter (especie %in% c("Merluza hubbsi", "Rayas nep", "Langostino", "Calamar Illex")) 
  

```





```{r}
especies_repre |> 
  ggplot(data = especies_repre, mapping = aes(x = fecha, y = captura)) + 
  geom_line (aes(colour = especie))
```





** Ensancho la tabla agregando una columna para cada especie**

```{r}
especies_repre


```

```{r}
especies_repre |> 
  pivot_wider(names_from = especie, values_from = captura, values_fill = 0)
```


```{r}
captura_puerto_flota_2010_2018 |>
  pivot_wider(names_from = especie, values_from = captura, values_fill = 0) |> 
  arrange(fecha)
 


```



**Cantidad de Variables que contiene la base** 

```{r}
colnames(captura_puerto_flota_2010_2018)
```

```{r}
captura_por_especie <-
  captura_puerto_flota_2010_2018[c("fecha", "flota", "puerto", "especie", "captura")]

```




```{r}
captura_agrupada_especie |> 
  pivot_wider(names_from = especie, values_from = captura, values_fill = 0) |> 
  arrange(fecha)
```















